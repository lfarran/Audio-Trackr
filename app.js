angular.module("AudioTrackr",[]).config(function(){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,window.AudioContext=window.AudioContext||window.webkitAudioContext}),angular.module("AudioTrackr").run(["$templateCache",function(t){t.put("track/track.html",'<div class="track" ng-class="{loading:loading==true}">\n    <h2>{{trackName}}<span ng-show="status"> ({{status}})</span></h2>\n    <input type="range" ng-model="trackVolume" />\n    <canvas></canvas>\n    <div class="spinner" ng-show="loading"></div>\n</div>')}]),angular.module("AudioTrackr").factory("audioTrackFactory",["$http",function(t){function a(t){this.ctx=t.ctx,this.useAudioTag=t.useAudioTag,this.url=t.url,this.outNode=t.outNode,this.fftSize=t.fftSize}return a.prototype.addGainNode=function(t){var a=this.ctx.createGain();return t.connect(a),a.connect(this.outNode),a},a.prototype.createAnalyser=function(t){var a=this.ctx.createAnalyser();return a.smoothingTimeConstant=.6,a.fftSize=this.fftSize,t.connect(a),a},a.prototype.loadAndDecode=function(a){var e=this;if(e.useAudioTag){var n=new Audio(e.url);n.addEventListener("canplaythrough",function(){e.node=e.ctx.createMediaElementSource(n),e.gainNode=e.addGainNode(e.node),e.analyser=e.createAnalyser(e.gainNode),a("ready")}),e.audio=n}else{if(e.buffer)return e.pauseTime=null,a("ready"),void 0;a("loading"),t.get(this.url,{responseType:"arraybuffer"}).then(function(t){a("decoding"),e.ctx.decodeAudioData(t.data,function(t){e.buffer=t,a("ready")})})}},a.prototype.play=function(){this.useAudioTag?this.audio.play():this.playBuffer()},a.prototype.stop=function(){this.useAudioTag?this.audio.pause():(this.bsNode.stop(0),this.pauseTime=this.ctx.currentTime-this.startTime)},a.prototype.setVolume=function(t){this.gainNode&&(this.gainNode.gain.value=t)},a.prototype.playBuffer=function(){this.bsNode=this.ctx.createBufferSource(),this.bsNode.buffer=this.buffer;var t=this.pauseTime||0;this.startTime=this.ctx.currentTime,this.pauseTime&&(this.startTime-=this.pauseTime),this.bsNode.start(0,t),this.gainNode=this.addGainNode(this.bsNode,this.outNode),this.analyser=this.createAnalyser(this.gainNode,this.fftSize)},a.prototype.clear=function(){this.audio&&(this.audio.src="")},{getNewAudioTrack:function(){var t=Object.create(a.prototype);return a.apply(t,arguments),t}}}]),angular.module("AudioTrackr").directive("track",function(){function t(t,a,e,n){function i(a){"ready"===a&&(t.loading=!1,a="",t.$parent.trackLoad(t.key,s)),e(function(){t.status=a})}function r(t){s.canvas=t,s.canvas.width=l,s.canvas.height=d,s.cCtx=s.canvas.getContext("2d");var a=s.cCtx.createLinearGradient(0,0,0,d);a.addColorStop(.15,"#e81717"),a.addColorStop(.75,"#7943cb"),a.addColorStop(1,"#005392"),s.cCtx.fillStyle=a,s.cCtx.strokeStyle="#AAA"}t.trackVolume=100,t.loading=!0;var o,c,s=t.track,u=a[0].querySelector("canvas"),l=t.$parent.trackWidth,d=200,m=.75,f=256,p=f/2,h=l/(p*m),g=l/p;!function(){o=n.getNewAudioTrack({ctx:t.$parent.aCtx,useAudioTag:t.$parent.useAudioTag,url:s.url,outNode:t.$parent.master.gainNode,fftSize:f}),o.loadAndDecode(i),r(u),t.$watch("trackVolume",function(t){t/=100,o.setVolume(t)})}(),s.play=function(){o.play(),c=o.analyser},s.stop=function(){o.stop()},s.clear=function(){o.clear()},s.draw=function(){var t=s.cCtx;if(c){var a=new Uint8Array(c.frequencyBinCount);c.getByteFrequencyData(a);var e=new Uint8Array(c.frequencyBinCount);c.getByteTimeDomainData(e),t.clearRect(0,0,l,d),t.beginPath();for(var n=0,i=a.length;i>n;n++){t.fillRect(n*h,d-a[n]/256*d,h-2,d);var r=e[n]/256,o=d-r*d-1;t.lineTo(n*g,o)}t.stroke()}}}return t.$inject=["$scope","$element","$timeout","audioTrackFactory"],{restrict:"EA",replace:!0,scope:{track:"=",trackName:"@"},link:function(){},templateUrl:"track/track.html",controller:t}}),angular.module("AudioTrackr").controller("MainController",["$scope","songFactory",function(t,a){function e(){angular.forEach(t.currentSong.tracks,function(t){t.draw&&t.draw()}),window.requestAnimationFrame(e)}function n(t){angular.forEach(t,function(t){t.clear()})}function i(){t.aCtx=new window.AudioContext,t.aCtx.createGain=t.aCtx.createGain||t.aCtx.createGainNode,t.master.gainNode=t.aCtx.createGain(),t.master.gainNode.connect(t.aCtx.destination),(!t.aCtx.createMediaElementSource||o)&&(t.useAudioTag=!1)}function r(){t.trackWidth=document.querySelector(".track-container").offsetWidth,t.trackWidth>1200?t.trackWidth/=3:t.trackWidth>800&&(t.trackWidth/=2),t.trackWidth-=22}var o=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,c=0;t.currentSong,t.songs=a,t.ready=!1,t.playing=!1,t.trackWidth,t.aCtx,t.master={},t.useAudioTag=!0,function(){return window.AudioContext?(r(),i(),void 0):(t.error=!0,void 0)}(),t.playTracks=function(a){a||(a=t.currentSong.tracks),angular.forEach(a,function(t){t.play()}),t.playing=!0},t.stopTracks=function(a){a||(a=t.currentSong.tracks),angular.forEach(a,function(t){t.stop()}),t.playing=!1},t.$watch("currentSong",function(a,e){t.playing&&t.stopTracks(e.tracks),e&&(n(e.tracks),t.ready=!1,c=0)}),t.trackLoad=function(){++c>=t.currentSong.tracks.length&&(t.ready=!0,t.$$phase||t.$apply(),e())}}]),angular.module("AudioTrackr").factory("songFactory",function(){return[{name:"Reckoner",band:"Radiohead",link:"https://itunes.apple.com/us/album/reckoner/id270079778?i=270079996",tracks:[{name:"guitar",url:"files/reckoner/guitar.mp3"},{name:"piano, strings",url:"files/reckoner/piano-strings.mp3"},{name:"bass",url:"files/reckoner/bass.mp3"},{name:"vocals",url:"files/reckoner/vocals.mp3"},{name:"backing vocals",url:"files/reckoner/backing vocals.mp3"},{name:"drums",url:"files/reckoner/drums.mp3"}]},{name:"Lisztomania",band:"Phoenix",link:"https://itunes.apple.com/us/album/lisztomania/id315002203?i=315002364",tracks:[{name:"guitar 1",url:"files/lisztomania/Guitar1.mp3"},{name:"guitar 2",url:"files/lisztomania/Guitar2.mp3"},{name:"guitar 3",url:"files/lisztomania/Guitar3.mp3"},{name:"bass",url:"files/lisztomania/Bass-combined.mp3"},{name:"cocotte",url:"files/lisztomania/Cocotte.mp3"},{name:"motif",url:"files/lisztomania/Motif.mp3"},{name:"brass",url:"files/lisztomania/Brass.mp3"},{name:"keys",url:"files/lisztomania/Key.mp3"},{name:"vocals",url:"files/lisztomania/Vox.mp3"},{name:"drums",url:"files/lisztomania/Beat.mp3"}]}]});
//# sourceMappingURL=app.js.map
